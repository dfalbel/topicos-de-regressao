---
title: "Exercício 3"
output:
  pdf_document:
    fig_caption: yes
    fig_height: 3.68
    fig_width: 3.84
---

```{r pacotes, echo=FALSE, warning=FALSE}
library(xtable)
library(knitr)
library(ggplot2)
library(tidyr)
library(plyr)
library(dplyr)
```

# Descrição

No arquivo __imoveis.dat__ são apresentados dados relativos a uma amostra de 27 imóveis. Na ordem são apresentados os valores das seguintes variáveis:

* imposto do imóvel (em 100 USD)
* área do terreno (em 1000 pés quadrados)
* área construída (em 1000 pés quadrados)
* idade da residência (em anos)
* preço de venda do imóvel (em 1000 USD)

# Enunciado

Ajuste um modelo normal linear do preço de venda contra as demais variáveis explicativas. Use o método AIC para selecionar as variáveis explicativas. Faça uma análise de diagnóstico com o modelo selecionado. Interprete os coeficientes estimados. Seja $y(z)$ o valor do preço de venda de um imóvel que não está na amostra com os valores das variáveis explciativas do modelo final representados por $z$. Como fica a estimativa intervalar de coeficiente $(1 - \alpha), 0 < \alpha < 1$, para $y(z)$? Alguma restrição para os valores de $z$?

# Leitura dos dados

Para ler os dados no R fazemos:

```{r}
imoveis <- data.frame(
  scan("dados/imoveis.dat", list(imposto=0, areat=0, areac=0, idade=0, preco=0)))
```

```{r, echo=FALSE, results='asis'}
kable(head(imoveis))
```

# Análise descritiva

```{r,fig.cap="Gráfico de dispersão da variável resposta 'Preço' por todas as variáveis explicativas."}
df <- gather(imoveis, key = var, value = value, -preco)
ggplot(df, aes(x=value, y=preco)) + geom_point() + stat_smooth(method = "lm", se = F) + 
  facet_wrap(~var, scales = "free") + xlab("Valor da variável") + ylab("Preço")
```

Vemos na figura 1 que todas as variáveis apresentam relação linear com a variável resposta. Quanto maior o imposto ou área de terreno ou área construida, maior a preço do imóvel. E quanto maior a idade do imóvel menor o preço do imóvel.

# Modelo

Para selecionar as variáveis explicativas vamos usar o método AIC. Neste caso como o número de variáveis explicativas é baixo, vamos ajustar todos os modelos possíveis e depois escolher aquele com o maior AIC.

Usando o código abaixo é possível ajustar todos os modelos com as variáveis do banco de dados.
```{r, eval=FALSE}
library(meifly)
todos.modelos <- fitall(imoveis$preco, imoveis[,-5])
variaveis <- laply(todos.modelos, .fun = function(x) return(paste(names(x$coefficients)
                                                                  , collapse = ", ")))
```

```{r, echo = F, results='hide'}
library(meifly)
todos.modelos <- fitall(imoveis$preco, imoveis[,-5])
```

```{r, echo=FALSE,results='asis'}
variaveis <- laply(todos.modelos, .fun = function(x) return(paste(names(x$coefficients)
                                                               , collapse = ", ")))
aux <- data.frame(cbind(variaveis, summary(todos.modelos))) %>% arrange(AIC)
row.names(aux) <- NULL
aux <- aux[,-c(2,9)]
kable(aux)
```

Vemos pela tabela acima que o modelo com maior AIC é aquele com as variáveis 'imposto' e 'areac' (área construída). Coincidentemente este modelo também apresenta o maior $R^2$ ajustado.







